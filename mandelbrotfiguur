
using System;
using System.Windows.Forms;
using System.Drawing;
using System.Diagnostics.Eventing.Reader;
using System.Text.Json.Serialization;
using System.ComponentModel.DataAnnotations;
using System.Drawing.Text;
using System.Globalization;



Form scherm = new Form();
scherm.ClientSize = new Size(1200, 815);
scherm.Text = "mandelbrot";


//aanmaken tekst-invoervelden en bijbehorende labels
Label midden_x = new Label();
TextBox invoerMidden_x = new TextBox();

Label midden_y = new Label();
TextBox invoerMidden_y = new TextBox();

Label schaal = new Label();
TextBox invoerSchaal = new TextBox();

Label maxAantal = new Label();
TextBox invoerMaxAantal = new TextBox();


scherm.Controls.Add(midden_x);
scherm.Controls.Add(invoerMidden_x);

scherm.Controls.Add(midden_y);
scherm.Controls.Add(invoerMidden_y);

scherm.Controls.Add(schaal);
scherm.Controls.Add(invoerSchaal);

scherm.Controls.Add(maxAantal);
scherm.Controls.Add(invoerMaxAantal);

// toekennen van eigenschappen aan tekst-invoervelden en bijbehorende labels
midden_x.Location = new Point(20, 20);
invoerMidden_x.Location = new Point(120, 18);
midden_x.Text = "midden x:";

midden_y.Location = new Point(20, 55);
invoerMidden_y.Location = new Point(120, 53);
midden_y.Text = "midden y:";

schaal.Location = new Point(20, 90);
invoerSchaal.Location = new Point(120, 88);
schaal.Text = "schaal:";

maxAantal.Location = new Point(20, 125);
invoerMaxAantal.Location = new Point(120, 123);
maxAantal.Text = "max aantal:";

//aanmaken schuifbar voor rood, groen en blauw
TrackBar invoerschuifrood = new TrackBar(); 
TrackBar invoerschuifgroen = new TrackBar();
TrackBar invoerschuifblauw = new TrackBar();

scherm.Controls.Add(invoerschuifrood);
scherm.Controls.Add(invoerschuifgroen);
scherm.Controls.Add(invoerschuifblauw);

Label schuifrood = new Label();
scherm.Controls.Add(schuifrood);
schuifrood.Location = new Point(20, 160);

Label schuifgroen = new Label();
scherm.Controls.Add(schuifgroen);
schuifgroen.Location = new Point(20, 240);

Label schuifblauw = new Label();
scherm.Controls.Add(schuifblauw);
schuifblauw.Location = new Point(20, 310);

invoerschuifrood.Location = new Point(20, 180);
schuifrood.Text = "roodwaarde:";
invoerschuifrood.Size = new Size(200, 20);
invoerschuifrood.Minimum = 0;
invoerschuifrood.Maximum = 255;
invoerschuifrood.Orientation = Orientation.Horizontal;

invoerschuifgroen.Location = new Point(20, 260);
schuifgroen.Text = "groenwaarde:";
invoerschuifgroen.Size = new Size(200, 20);
invoerschuifgroen.Minimum = 0;
invoerschuifgroen.Maximum = 255;
invoerschuifgroen.Orientation = Orientation.Horizontal;

invoerschuifblauw.Location = new Point(20, 340);
schuifblauw.Text = "blauwwaarde:";
invoerschuifblauw.Size = new Size(200, 20);
invoerschuifblauw.Minimum = 0;
invoerschuifblauw.Maximum = 255;
invoerschuifblauw.Orientation = Orientation.Horizontal;

// knop voor tekenen
Button knop = new Button();
knop.Location = new Point(260, 121);
scherm.Controls.Add(knop);
knop.Text = "Teken!";

// aanmaken bitmap en grootte bepalen
Bitmap plaatje = new Bitmap(720, 720);
int bitmapHoogte = 720;
int bitmapBreedte = 720;

//globale waardes bij opstart
invoerMidden_x.Text = "0";
invoerMidden_y.Text = "0";
invoerSchaal.Text = "0.01";
invoerMaxAantal.Text = "100";



// globale minimale en maximale waardes
double min_x = -2;
double max_x = 2;
double min_y = -2;
double max_y = 2;


// berekening mandelbrotgetal
int mandelbrotgetal(double x, double y)
{
    double afstand = 0;
    int teller = 0;
    double maxAantalHerhalingen = double.Parse(invoerMaxAantal.Text);

    double a = 0;
    double b = 0;

    while (afstand < 2 && teller < maxAantalHerhalingen)
    {
        double xa = a * a - b * b + x;
        double yb = 2 * a * b + y;

        double pythagoras = Math.Pow(xa - 0, 2) + Math.Pow(yb - 0, 2);
        afstand = Math.Sqrt(pythagoras);

        a = xa;
        b = yb;

        teller = teller + 1;
    }

    return teller;

}

void veranderschuif(object o, EventArgs ea)
{
    mandelbrotplaatje(o, ea);
}

//kleurtjes!
Color[] kleuren = new Color[]
{
    Color.Blue,
    Color.Green,
    Color.Yellow,
    Color.Orange,
    Color.Red,
    Color.Purple
};
Color InterpoleerKleur(int iteratie, int maxIteraties)
{
    double t = (double)iteratie / double.Parse(invoerMaxAantal.Text);
    int index1 = (int)(t * (kleuren.Length - 1));
    int index2 = Math.Min(index1 + 1, kleuren.Length - 1);

    double fractie = t * (kleuren.Length - 1) - index1;

    int rood = invoerschuifrood.Value;
    int groen = invoerschuifgroen.Value;
    int blauw = invoerschuifblauw.Value;

    int r = Math.Min(255, kleuren[index1].R + (int)(fractie * (kleuren[index2].R - kleuren[index1].R)) + invoerschuifrood.Value);
    int g = Math.Min(255, kleuren[index1].G + (int)(fractie * (kleuren[index2].G - kleuren[index1].G)) + invoerschuifgroen.Value);
    int b = Math.Min(255, kleuren[index1].B + (int)(fractie * (kleuren[index2].B - kleuren[index1].B)) + invoerschuifblauw.Value);


    return Color.FromArgb(r, g, b);
}





//berekening mandelbrot en pixelkleuren
void mandelbrotplaatje(object o, EventArgs e)
{
    int maxAantalHerhalingen = int.Parse(invoerMaxAantal.Text);

    double midden_x = Double.Parse(invoerMidden_x.Text);
    double midden_y = Double.Parse(invoerMidden_y.Text);
    double schaal = Double.Parse(invoerSchaal.Text);

    min_x = midden_x - (2 * schaal);
    max_x = midden_x + (2 * schaal);
    min_y = midden_y - (2 * schaal);
    max_y = midden_y + (2 * schaal);

    for (int pixel_x = 0; pixel_x < bitmapBreedte; pixel_x++)
    {

        for (int pixel_y = 0; pixel_y < bitmapHoogte; pixel_y++)
        {

            double x = min_x + (pixel_x / (double)bitmapBreedte) * (max_x - min_x);
            double y = min_y + (pixel_y / (double)bitmapHoogte) * (max_y - min_y);

            int uitkomst = mandelbrotgetal(x, y);

            Color kleur = InterpoleerKleur(uitkomst, maxAantalHerhalingen);
            plaatje.SetPixel(pixel_x, pixel_y, kleur);
           
        }


    }
    scherm.Invalidate();

}
;

// daadwerkelijke tekening op bitmap
void tekening(object o, PaintEventArgs pea)
{
    pea.Graphics.DrawImage(plaatje, 440, 20);
}

void zoom(object o, MouseEventArgs ea)
{

    if (ea.Button == MouseButtons.Left)
    {
        // fixen van offset veroorzaakt doordat je de bitmap tekent op (440,20)
        int offsetx = 440;
        int offsety = 20;

        double zoom_x = min_x + ((ea.X - offsetx) / (double)bitmapBreedte) * (max_x - min_x);
        double zoom_y = min_y + ((ea.Y - offsety) / (double)bitmapHoogte) * (max_y - min_y);

        double zoomFactor = 0.5;

        double nieuw_x = (max_x - min_x) * zoomFactor;
        double nieuw_y = (max_y - min_y) * zoomFactor;

        // nieuw bereik aanmaken voor zoom
        min_x = zoom_x - nieuw_x / 2;
        max_x = zoom_x + nieuw_x / 2;
        min_y = zoom_y - nieuw_y / 2;
        max_y = zoom_y + nieuw_y / 2;

        //meeveranderen van waarden van midden x en y met 6 decimalen
        double nieuwmidden_x = (min_x + max_x) / 2;
        double nieuwmidden_y = (min_y + max_y) / 2;

        invoerMidden_x.Text = nieuwmidden_x.ToString("F6");
        invoerMidden_y.Text = nieuwmidden_y.ToString("F6");

        // nieuw invoer maken zodat click meerdere keer werkt
        double nieuweSchaal = (max_x - min_x) / 4;
        invoerSchaal.Text = nieuweSchaal.ToString("F6");

    }
    mandelbrotplaatje(o, ea);
}

void zoomOut(object o, MouseEventArgs ea)
{

    if (ea.Button == MouseButtons.Right)
    {
        // fixen van offset veroorzaakt doordat je de bitmap tekent op (20,175)
        int offsetx = 440;
        int offsety = 20;

        double zoom_x = min_x + ((ea.X - offsetx) / (double)bitmapBreedte) * (max_x - min_x);
        double zoom_y = min_y + ((ea.Y - offsety) / (double)bitmapHoogte) * (max_y - min_y);

        double zoomFactor = 0.5;

        double nieuw_x = (max_x - min_x) / zoomFactor;
        double nieuw_y = (max_y - min_y) / zoomFactor;

        // nieuw bereik aanmaken voor zoom
        min_x = zoom_x - nieuw_x / 2;
        max_x = zoom_x + nieuw_x / 2;
        min_y = zoom_y - nieuw_y / 2;
        max_y = zoom_y + nieuw_y / 2;

        //meeveranderen van waarden van midden x en y met 6 decimalen
        double nieuwmidden_x = (min_x + max_x) / 2;
        double nieuwmidden_y = (min_y + max_y) / 2;

        invoerMidden_x.Text = nieuwmidden_x.ToString("F6");
        invoerMidden_y.Text = nieuwmidden_y.ToString("F6");

        double nieuweSchaal = (max_x - min_x) / 4;
        invoerSchaal.Text = nieuweSchaal.ToString("F6");

    }
    mandelbrotplaatje(o, ea);
}


invoerschuifrood.Scroll += veranderschuif;
invoerschuifgroen.Scroll += veranderschuif;
invoerschuifblauw.Scroll += veranderschuif;
scherm.MouseClick += zoom;
scherm.MouseClick += zoomOut;
scherm.Paint += tekening;
knop.Click += mandelbrotplaatje;

mandelbrotplaatje(null, EventArgs.Empty);


Application.Run(scherm);

